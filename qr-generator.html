<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur QR Codes - Express Resto</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .url-config {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        input[type="url"] {
            width: 100%;
            padding: 1rem;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input[type="url"]:focus {
            border-color: #e74c3c;
            outline: none;
        }
        
        .table-range {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .table-range input {
            width: 80px;
            padding: 0.8rem;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            text-align: center;
            font-size: 1.1rem;
        }
        
        .btn {
            padding: 0.8rem 2rem;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: bold;
        }
        
        .btn:hover {
            background: #c0392b;
        }
        
        .btn-secondary {
            background: #3498db;
        }
        
        .btn-secondary:hover {
            background: #2980b9;
        }
        
        .qrcode-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .qrcode-card {
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .qrcode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: #e74c3c;
        }
        
        .table-badge {
            background: #e74c3c;
            color: white;
            display: inline-block;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }
        
        .qr-image {
            width: 200px;
            height: 200px;
            margin: 1rem auto;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }
        
        .qr-image canvas {
            max-width: 100%;
            max-height: 100%;
        }
        
        .qr-url {
            font-size: 0.8rem;
            color: #7f8c8d;
            word-break: break-all;
            margin: 0.5rem 0;
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 5px;
        }
        
        .btn-print {
            background: #27ae60;
            margin-top: 0.5rem;
            width: 100%;
        }
        
        .btn-download {
            background: #f39c12;
            margin-top: 0.5rem;
            width: 100%;
        }
        
        .print-section {
            display: none;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .no-print {
                display: none;
            }
            .print-section {
                display: block;
            }
            .qrcode-card {
                break-inside: avoid;
                page-break-inside: avoid;
                border: 1px solid #ccc;
            }
        }
        
        .preview-url {
            background: #ecf0f1;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            font-family: monospace;
            word-break: break-all;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>üì± G√âN√âRATEUR DE QR CODES PAR TABLE</h1>
        <p class="subtitle">Cr√©ez des QR codes uniques pour chaque table de votre restaurant</p>
        
        <!-- Configuration de l'URL -->
        <div class="url-config no-print">
            <h2 style="color: #2c3e50; margin-bottom: 1rem;">üîß 1. Configuration du site</h2>
            
            <div class="form-group">
                <label>URL de votre site Express Resto</label>
                <input type="url" id="siteUrl" value="https://votre-site.netlify.app" placeholder="https://votre-site.netlify.app">
                <p style="color: #7f8c8d; margin-top: 0.5rem;">‚ÑπÔ∏è Exemple: https://mon-resto.netlify.app</p>
            </div>
            
            <h2 style="color: #2c3e50; margin: 2rem 0 1rem;">üî¢ 2. Num√©ros de tables</h2>
            
            <div class="table-range">
                <div>
                    <label>De la table</label>
                    <input type="number" id="tableStart" value="1" min="1" max="50">
                </div>
                <div>
                    <label>√Ä la table</label>
                    <input type="number" id="tableEnd" value="10" min="1" max="50">
                </div>
                <div style="margin-top: 1.5rem;">
                    <button id="generateBtn" class="btn">üé≤ G√âN√âRER LES QR CODES</button>
                </div>
            </div>
            
            <div style="margin-top: 1rem;">
                <button id="printAllBtn" class="btn btn-secondary">üñ®Ô∏è IMPRIMER TOUT</button>
                <button id="clearBtn" class="btn" style="background: #95a5a6;">üóëÔ∏è EFFACER</button>
            </div>
            
            <div id="urlPreview" class="preview-url" style="display: none;">
                Aper√ßu de l'URL : <span id="previewUrlText"></span>
            </div>
        </div>
        
        <!-- QR Codes g√©n√©r√©s -->
        <h2 style="color: #2c3e50; margin: 2rem 0 1rem;" class="no-print">üì≤ 3. QR Codes g√©n√©r√©s</h2>
        <div id="qrcodes" class="qrcode-container"></div>
        
        <!-- Instructions d'impression -->
        <div class="no-print" style="margin-top: 3rem; background: #fff3cd; padding: 1.5rem; border-radius: 10px; border-left: 5px solid #ffc107;">
            <h3 style="color: #856404; margin-bottom: 0.5rem;">üìå Comment utiliser :</h3>
            <ol style="color: #856404; margin-left: 1.5rem;">
                <li>Entrez l'URL de votre site Netlify</li>
                <li>Choisissez les num√©ros de tables (ex: de 1 √† 10)</li>
                <li>Cliquez sur "G√âN√âRER"</li>
                <li>Imprimez les QR codes</li>
                <li>D√©coupez et plastifiez</li>
                <li>Collez sur les tables !</li>
            </ol>
            <p style="margin-top: 1rem; font-weight: bold;">‚úÖ Le num√©ro de table sera automatiquement transmis au g√©rant dans la commande WhatsApp !</p>
        </div>
    </div>
    
    <script>
        // ===========================================
        // G√âN√âRATION DES QR CODES
        // ===========================================
        document.getElementById('generateBtn').addEventListener('click', function() {
            const siteUrl = document.getElementById('siteUrl').value;
            const tableStart = parseInt(document.getElementById('tableStart').value);
            const tableEnd = parseInt(document.getElementById('tableEnd').value);
            
            // V√©rifier l'URL
            if (!siteUrl || siteUrl === 'https://votre-site.netlify.app') {
                alert('‚ùå Veuillez entrer votre URL Netlify valide');
                return;
            }
            
            // Nettoyer l'URL
            let baseUrl = siteUrl.replace(/\/$/, ''); // Enlever le / final
            
            // Afficher l'aper√ßu
            document.getElementById('urlPreview').style.display = 'block';
            document.getElementById('previewUrlText').textContent = `${baseUrl}/?table=1`;
            
            // G√©n√©rer les QR codes
            const container = document.getElementById('qrcodes');
            container.innerHTML = '';
            
            for (let i = tableStart; i <= tableEnd; i++) {
                generateQRCode(baseUrl, i, container);
            }
        });
        
        function generateQRCode(baseUrl, tableNumber, container) {
            const url = `${baseUrl}/?table=${tableNumber}`;
            
            const card = document.createElement('div');
            card.className = 'qrcode-card';
            
            // Badge table
            const badge = document.createElement('div');
            badge.className = 'table-badge';
            badge.textContent = `TABLE ${tableNumber}`;
            
            // Conteneur QR
            const qrDiv = document.createElement('div');
            qrDiv.className = 'qr-image';
            qrDiv.id = `qr-${tableNumber}`;
            
            // URL
            const urlDiv = document.createElement('div');
            urlDiv.className = 'qr-url';
            urlDiv.textContent = url;
            
            // Boutons
            const downloadBtn = document.createElement('button');
            downloadBtn.className = 'btn btn-download';
            downloadBtn.innerHTML = 'üì• T√©l√©charger';
            downloadBtn.onclick = function() {
                const canvas = qrDiv.querySelector('canvas');
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = `table-${tableNumber}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                }
            };
            
            const printBtn = document.createElement('button');
            printBtn.className = 'btn btn-print';
            printBtn.innerHTML = 'üñ®Ô∏è Imprimer';
            printBtn.onclick = function() {
                const canvas = qrDiv.querySelector('canvas');
                if (canvas) {
                    const win = window.open('');
                    win.document.write('<html><head><title>Table ' + tableNumber + '</title></head><body style="text-align: center; padding: 20px;">');
                    win.document.write('<h1>TABLE ' + tableNumber + '</h1>');
                    win.document.write('<img src="' + canvas.toDataURL('image/png') + '" style="width: 300px; height: 300px;">');
                    win.document.write('<p>Scannez pour commander</p>');
                    win.document.write('</body></html>');
                    win.print();
                }
            };
            
            card.appendChild(badge);
            card.appendChild(qrDiv);
            card.appendChild(urlDiv);
            card.appendChild(downloadBtn);
            card.appendChild(printBtn);
            
            container.appendChild(card);
            
            // G√©n√©rer le QR code
            QRCode.toCanvas(qrDiv, url, {
                width: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#ffffff'
                }
            }, function(error) {
                if (error) console.error(error);
            });
        }
        
        // ===========================================
        // IMPRESSION TOUS LES QR CODES
        // ===========================================
        document.getElementById('printAllBtn').addEventListener('click', function() {
            const qrCards = document.querySelectorAll('.qrcode-card');
            if (qrCards.length === 0) {
                alert('‚ùå G√©n√©rez d\'abord des QR codes');
                return;
            }
            
            const win = window.open('');
            win.document.write('<html><head><title>Toutes les tables</title>');
            win.document.write('<style>');
            win.document.write('body { font-family: Arial; padding: 20px; }');
            win.document.write('.print-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }');
            win.document.write('.table-card { text-align: center; page-break-inside: avoid; border: 1px solid #ccc; padding: 20px; }');
            win.document.write('h1 { color: #e74c3c; }');
            win.document.write('img { width: 200px; height: 200px; }');
            win.document.write('</style>');
            win.document.write('</head><body>');
            win.document.write('<div class="print-grid">');
            
            qrCards.forEach((card, index) => {
                const tableNum = card.querySelector('.table-badge').textContent;
                const canvas = card.querySelector('canvas');
                if (canvas) {
                    win.document.write('<div class="table-card">');
                    win.document.write('<h1>' + tableNum + '</h1>');
                    win.document.write('<img src="' + canvas.toDataURL('image/png') + '">');
                    win.document.write('<p>Scannez pour commander</p>');
                    win.document.write('</div>');
                }
            });
            
            win.document.write('</div>');
            win.document.write('</body></html>');
            
            setTimeout(() => {
                win.print();
            }, 500);
        });
        
        // ===========================================
        // EFFACER
        // ===========================================
        document.getElementById('clearBtn').addEventListener('click', function() {
            document.getElementById('qrcodes').innerHTML = '';
            document.getElementById('urlPreview').style.display = 'none';
        });
        
        // ===========================================
        // PR√âVISUALISATION EN TEMPS R√âEL
        // ===========================================
        document.getElementById('siteUrl').addEventListener('input', function() {
            const url = this.value;
            const preview = document.getElementById('urlPreview');
            const previewText = document.getElementById('previewUrlText');
            
            if (url && url !== 'https://votre-site.netlify.app') {
                preview.style.display = 'block';
                previewText.textContent = `${url.replace(/\/$/, '')}/?table=1`;
            } else {
                preview.style.display = 'none';
            }
        });
        
        // ===========================================
        // CHARGEMENT INITIAL
        // ===========================================
        window.onload = function() {
            // Essayer de d√©tecter l'URL actuelle
            const currentUrl = window.location.origin;
            if (currentUrl && !currentUrl.includes('localhost') && !currentUrl.includes('file://')) {
                document.getElementById('siteUrl').value = currentUrl;
            }
        };
    </script>
</body>
</html>